
# 鳥栖PO1期 可視化ツール（Streamlit）

**機能**
1. 基本プロット（kW・30分） — ロス前/ロス後を同一グラフに表示、期間指定可（価格の右軸重ね可）  
2. 集計（kWベース） — 日/月の mean/max/min（価格平均の右軸重ね可）  
4. オーバレイ（kW/価格） — 指定日、月ごと同日、年ごと同月日で日曲線（0..47スロット）比較  
5. 単独表示（kW・範囲指定） — 30分 / 日平均 / 月平均、ロス前/ロス後の選択（価格重ね可）  
6. **供出可能量（定義①）** — 式: `max(0, PCS - (L - G))` を時系列で計算し、**1年推移と最小値（点線）を表示**。CSV出力。

**前提**  
- Excelに最低限「開始日時」「使用電力量(ロス後)」「使用電力量(ロス前)」があること  
- 30分間隔（0.5h）を前提。kWh → kW は `kW = kWh / 0.5` で換算  
- 価格は任意列「JEPXスポットプライス」を使用（存在時のみ）

## 使い方

### ローカル実行
```bash
pip install -r requirements.txt
streamlit run app.py
```

### データの準備
- サイドバーの *Excelアップロード* から読み込み（シート名未指定時は先頭）。
- kW列（「使用電力量(ロス後)_kW」「使用電力量(ロス前)_kW」）は自動生成。

### 供出可能量（定義①：1000-(L-G)）
- サイドバーで `PCS定格（kW）` を設定（既定 1000）。
- 逆潮上限（kW）があれば数値入力（空欄=無制限）。
- タブ「6) 供出可能量」で、必要なら **需要列／自家発列** を明示選択。未指定時は
  - 需要 \(L\)：`需要計画量(ロス前)` → なければ `使用電力量(ロス後)÷0.5`（kW換算）
  - 自家発 \(G\)：`自家発出力` / `PV出力` などがあれば使用、無ければ 0

表示内容：  
- **時系列カーブ（選択期間）**  
- **最小値の水平点線とラベル**（時刻付き）  
- **CSVダウンロード**（供出可能量、需要kW、自家発kW）

## デプロイ（GitHub + Streamlit Cloud）
1. GitHub にこのディレクトリを push  
2. Streamlit Cloud で New app → リポジトリ/ブランチ指定、`app.py` をエントリに設定  
3. 画面からExcelをアップロードして利用可能

## 注意
- 実務適用時は、契約・連系上限、SoC/持続時間、効率やマージン、他設備の同時制約などを別途考慮してください。


## 追加機能
- **価格：1年分オーバレイ**（各日×48スロット、縦軸上限を指定可能）
- **SOCシミュレーション（周期リセット）**：初期SOC、下限SOC、充電間隔（日）、電池容量、PCS定格、需要列/自家発列をパラメータ化
